!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=105)}({0:function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"c",function(){return a}),i.d(t,"d",function(){return s}),i.d(t,"b",function(){return c});var n=i(7),o=function(){function e(e,t,i,n){void 0===n&&(n=0),this.OldIndex=e,this.NewIndex=t,this.MergedValue=n,this.Value=i}return e.prototype.IsDeleted=function(){return this.MergedValue<0},e.prototype.IsMerged=function(){return this.MergedValue>0},e}(),r=function(){return function(e){this.Position=e}}(),a=function(e){function t(t,i,n){var o=e.call(this,t)||this;return o.TilePosToMergeWith=i,o.NewValue=n,o}return n.a(t,e),t}(r),s=function(e){function t(t,i,n,o){var r=e.call(this,t)||this;return r.NewPosition=i,r.Value=n,r.ShouldBeDeleted=o,r}return n.a(t,e),t}(r),c=function(e){function t(t,i){var n=e.call(this,t)||this;return n.TileValue=i,n}return n.a(t,e),t}(r)},1:function(e,t,i){"use strict";var n;i.d(t,"a",function(){return n}),function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Right=2]="Right",e[e.Left=3]="Left"}(n||(n={}))},101:function(e,t,i){"use strict";i.r(t);var n=i(4),o=i(11),r=i(8),a=i(0);describe("Row Processor tests",function(){function e(e){for(var t=[],i=0;i<e.length;++i)t.push(new n.a(i,0,e[i]));return t}it("Nothing moves",function(){var t=e([2,0,0,0]),i=o.a.ProcessRow(t);Object(r.a)(i,[])}),it("Nothing moves 2",function(){var t=e([2,4,8,16]),i=o.a.ProcessRow(t);Object(r.a)(i,[])}),it("Single move",function(){var t=e([0,0,0,2]),i=[new a.a(3,0,2)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Stacked move",function(){var t=e([0,2,0,4]),i=[new a.a(1,0,2),new a.a(3,1,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Stacked move 2",function(){var t=e([0,2,4,8]),i=[new a.a(1,0,2),new a.a(2,1,4),new a.a(3,2,8)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Simple merge",function(){var t=e([2,2,0,0]),i=[new a.a(0,0,2,-1),new a.a(1,0,2,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Merge with space",function(){var t=e([2,0,2,0]),i=[new a.a(0,0,2,-1),new a.a(2,0,2,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Move with merge",function(){var t=e([0,0,2,2]),i=[new a.a(2,0,2,-1),new a.a(3,0,2,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Move with merge with spaces",function(){var t=e([0,2,0,2]),i=[new a.a(1,0,2,-1),new a.a(3,0,2,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)}),it("Double merge",function(){var t=e([2,2,2,2]),i=[new a.a(0,0,2,-1),new a.a(1,0,2,4),new a.a(2,1,2,-1),new a.a(3,1,2,4)],n=o.a.ProcessRow(t);Object(r.a)(n,i)})})},102:function(e,t,i){"use strict";i.r(t);var n=i(6),o=i(4),r=i(1),a=i(8);describe("Grid state",function(){it("Empty grid serializaion",function(){var e=new n.a(2);expect(e.Serialize()).toBe("0,0|0,0")}),it("Filled grid serializaion",function(){var e=new n.a(2);e.InsertTile(0,0,1),e.InsertTile(0,1,2),e.InsertTile(1,0,3),e.InsertTile(1,1,4),expect(e.Serialize()).toBe("1,2|3,4")}),it("Grid deserializaion",function(){var e=n.a.Deserialize("1,2,3|4,5,6|7,8,9");expect(e.Serialize()).toBe("1,2,3|4,5,6|7,8,9")})}),describe("Grid insert tests",function(){it("Grid creation",function(){var e=new n.a(4);expect(e.Size).toBe(4)}),it("Grid after creation all is available",function(){var e=new n.a(3).AvailableCells();expect(e.length).toBe(9)}),it("Grid available cells",function(){var e=new n.a(2);e.InsertTile(0,0,2),expect(e.AvailableCells().length).toBe(3),e.InsertTile(0,1,2),expect(e.AvailableCells().length).toBe(2),e.InsertTile(1,0,2),expect(e.AvailableCells().length).toBe(1),e.InsertTile(1,1,2),expect(e.AvailableCells().length).toBe(0)}),it("Grid insert wrong dimension",function(){var e=new n.a(3);expect(function(){e.InsertTile(-1,0,2)}).toThrow(),expect(function(){e.InsertTile(1,-1,2)}).toThrow(),expect(function(){e.InsertTile(3,1,2)}).toThrow(),expect(function(){e.InsertTile(1,3,2)}).toThrow()}),it("Grid insert occupied",function(){var e=new n.a(3);e.InsertTile(0,0,2),expect(function(){e.InsertTile(0,0,2)}).toThrow()})}),describe("Grid get data by direction",function(){it("Left",function(){var e=n.a.Deserialize("1,2|3,4").GetRowDataByDirection(r.a.Left),t=new o.a(0,0,1),i=new o.a(0,1,2),s=new o.a(1,0,3),c=new o.a(1,1,4);Object(a.b)(e[0],[t,i]),Object(a.b)(e[1],[s,c])}),it("Right",function(){var e=n.a.Deserialize("1,2|3,4").GetRowDataByDirection(r.a.Right),t=new o.a(0,0,1),i=new o.a(0,1,2),s=new o.a(1,0,3),c=new o.a(1,1,4);Object(a.b)(e[0],[i,t]),Object(a.b)(e[1],[c,s])}),it("Up",function(){var e=n.a.Deserialize("1,2|3,4").GetRowDataByDirection(r.a.Up),t=new o.a(0,0,1),i=new o.a(0,1,2),s=new o.a(1,0,3),c=new o.a(1,1,4);Object(a.b)(e[0],[t,s]),Object(a.b)(e[1],[i,c])}),it("Down",function(){var e=n.a.Deserialize("1,2|3,4").GetRowDataByDirection(r.a.Down),t=new o.a(0,0,1),i=new o.a(0,1,2),s=new o.a(1,0,3),c=new o.a(1,1,4);Object(a.b)(e[0],[s,t]),Object(a.b)(e[1],[c,i])})})},103:function(e,t,i){"use strict";i.r(t);var n=i(6),o=i(25),r=i(1),a=i(13),s=i(0);describe("App tests",function(){function e(e,t,i){void 0===i&&(i=-1);var n=e.GetTile(t.RowIndex,t.CellIndex);i>=0?expect(n.Value).toEqual(i,"Tile value is not expected"):expect(n.Value).toBeGreaterThan(0,"Tile value should be greater than zero")}function t(t){var i=new o.a(4,{GetRandomNumber:function(){return 0}});i.Grid=n.a.Deserialize(t.Serialize());var r=new a.a;return i.BindRender({OnGameFinished:function(){},OnTilesUpdated:function(i){i instanceof s.d?function(t,i){e(t,i.Position,i.Value),t.RemoveTileByPos(i.Position),t.UpdateTileByPos(i.NewPosition,i.Value)}(t,i):i instanceof s.c?function(t,i){e(t,i.Position),t.RemoveTileByPos(i.Position),t.UpdateTileByPos(i.TilePosToMergeWith,i.NewValue)}(t,i):i instanceof s.b&&function(t,i){e(t,i.Position,0),t.InsertTileByPos(i.Position,i.TileValue)}(t,i)},OnTurnAnimationsCompleted:r}),i}it("Game situation test 1",function(){var e=n.a.Deserialize("2,4,0,0|0,0,0,0|2,0,0,2|0,0,0,0"),i=t(e);i.Action(r.a.Right);var o=i.Grid.Serialize();expect(o).toBe("2,0,2,4|0,0,0,0|0,0,0,4|0,0,0,0"),expect(e.Serialize()).toBe(o)}),it("Game situation test 2",function(){var e=n.a.Deserialize("0,2,2,0|0,0,0,0|0,0,2,0|0,0,0,0"),i=t(e);i.Action(r.a.Left);var o=i.Grid.Serialize();expect(o).toBe("4,2,0,0|0,0,0,0|2,0,0,0|0,0,0,0"),expect(e.Serialize()).toBe(o)})})},104:function(e,t,i){var n={"./app.spec.ts":103,"./grid.spec.ts":102,"./row-processor.spec.ts":101};function o(e){var t=r(e);return i(t)}function r(e){var t=n[e];if(!(t+1)){var i=new Error('Cannot find module "'+e+'".');throw i.code="MODULE_NOT_FOUND",i}return t}o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=104},105:function(e,t,i){var n=i(104);n.keys().forEach(n)},11:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),o=function(){function e(){}return e.ProcessRow=function(e){for(var t=e[0].Value,i=e[0].Value>0?1:0,o=[],r=void 0,a=1;a<e.length;++a){var s=e[a].Value;0!=s&&(t==s?(r?r.MergedValue=-1:o.push(new n.a(i-1,i-1,s,-1)),o.push(new n.a(a,i-1,s,s+t)),t=0):(a>i&&(r=new n.a(a,i,s),o.push(r)),t=s,++i))}return o},e}()},13:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var n=function(){function e(){this.observers=[]}return e.prototype.RegisterObserver=function(e){this.observers.push(e)},e.prototype.RemoveObserver=function(e){this.observers.splice(this.observers.indexOf(e),1)},e.prototype.NotifyObservers=function(e){this.observers.forEach(function(t){t(e)})},e}()},25:function(e,t,i){"use strict";var n=i(1),o=i(6),r=i(11),a=i(13),s=function(){function e(){}return e.ConsoleLog=function(e,t,i,n){void 0===i&&(i=!1);var o="";i&&(o+="font-weight:bold; "),n&&(o+="color:"+n+"; "),""!=o?console.log("%c"+e,o,t):console.log(e,t)},e}(),c=i(4),u=i(0);i.d(t,"a",function(){return l});var l=function(){function e(e,t){this.Scores=0,this.OnTilesUpdated=new a.a,this.OnGameFinished=new a.a,this.userActionsQueue=[],this.rand=t,this.Grid=new o.a(e),this.insertNewTileToVacantSpace()}return e.prototype.BindRender=function(e){this.OnTilesUpdated.RegisterObserver(e.OnTilesUpdated.bind(e)),this.OnGameFinished.RegisterObserver(e.OnGameFinished.bind(e)),e.OnTurnAnimationsCompleted.RegisterObserver(this.fetchAndExecuteUserActionFromQueue.bind(this))},e.prototype.Serialize=function(){var e={Scores:this.Scores,GridSerialized:this.Grid.Serialize()};return JSON.stringify(e)},e.prototype.InitFromState=function(e){var t=JSON.parse(e);this.Scores=t.Scores,this.Grid=o.a.Deserialize(t.GridSerialized)},e.prototype.Action=function(e){var t=this.processAction.bind(this,e);this.userActionsQueue.push(t),1==this.userActionsQueue.length&&t()},e.prototype.fetchAndExecuteUserActionFromQueue=function(){(this.userActionsQueue.splice(0,1),this.userActionsQueue.length>0)&&(0,this.userActionsQueue[0])()},e.prototype.calculateGameEvents=function(e){for(var t=[],i=this.Grid.GetRowDataByDirection(e),n=0;n<i.length;++n)for(var o=r.a.ProcessRow(i[n]),a=0;a<o.length;++a){var s=o[a],c=i[n][s.OldIndex],l=i[n][s.NewIndex];s.IsMerged()?t.push(new u.c(c,l,s.MergedValue)):t.push(new u.d(c,l,s.Value,s.IsDeleted()))}return t},e.prototype.processAction=function(e){s.ConsoleLog("start process action",[this.Grid.Serialize(),n.a[e]]);for(var t=this.calculateGameEvents(e),i=0;i<t.length;++i){var o=t[i];if(o instanceof u.d){var r=o;this.Grid.UpdateTileByPos(r.NewPosition,r.Value),this.Grid.RemoveTileByPos(r.Position)}if(o instanceof u.c){var a=o;this.Grid.UpdateTileByPos(a.TilePosToMergeWith,a.NewValue),this.Grid.RemoveTileByPos(a.Position),this.Scores+=a.NewValue}this.OnTilesUpdated.NotifyObservers(o)}if(t.length>0){var c=this.insertNewTileToVacantSpace();c&&this.OnTilesUpdated.NotifyObservers(new u.b(c,c.Value))}else{if(this.OnTilesUpdated.NotifyObservers(void 0),0==this.Grid.AvailableCells().length)this.calculateGameEvents(n.a.Up).length>0||this.calculateGameEvents(n.a.Right).length>0||this.calculateGameEvents(n.a.Left).length>0||this.calculateGameEvents(n.a.Down).length>0||this.OnGameFinished.NotifyObservers(void 0)}s.ConsoleLog("  end process action",[this.Grid.Serialize()])},e.prototype.insertNewTileToVacantSpace=function(){var e=this.Grid.AvailableCells();if(e.length>0){var t=e[this.rand.GetRandomNumber(e.length)],i=new c.a(t.RowIndex,t.CellIndex,2);return this.Grid.InsertTileByPos(i,i.Value),i}},e}()},4:function(e,t,i){"use strict";i.d(t,"b",function(){return o}),i.d(t,"a",function(){return r});var n=i(7),o=function(){function e(e,t){this.RowIndex=e,this.CellIndex=t}return e.prototype.toString=function(){return"["+this.RowIndex+","+this.CellIndex+"]"},e}(),r=function(e){function t(t,i,n){var o=e.call(this,t,i)||this;return o.Value=n,o}return n.a(t,e),t}(o)},6:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(1),o=i(4),r=function(){function e(e){this.Size=e,this.Cells=new Array(this.Size);for(var t=0;t<this.Size;t++){this.Cells[t]=new Array(this.Size);for(var i=0;i<this.Size;i++)this.Cells[t][i]=0}}return e.prototype.Serialize=function(){for(var e=[],t=0;t<this.Size;++t)e.push(this.Cells[t].join(","));return e.join("|")},e.Deserialize=function(t){var i=new e(1);return i.InitFromState(t),i},e.prototype.InitFromState=function(e){var t=e.split("|");this.Size=t.length,this.Cells=[];for(var i=0;i<this.Size;++i){var n=[];this.Cells.push(n);var o=t[i].split(",");if(o.length!=this.Size)throw"Incorrect serialized grid state";for(var r=0;r<this.Size;++r)n.push(parseInt(o[r],10))}},e.prototype.InsertTileByPos=function(e,t){this.InsertTile(e.RowIndex,e.CellIndex,t)},e.prototype.InsertTile=function(e,t,i){if(e<0)throw"X position "+e+"is < 0";if(t<0)throw"Y position "+t+"is < 0";if(e>=this.Size)throw"X position "+e+"is more than grid size";if(t>=this.Size)throw"Y position "+t+"is more than grid size";if(0!=this.Cells[e][t])throw"Cell with position "+e+", "+t+" is occupied";this.Cells[e][t]=i},e.prototype.RemoveTile=function(e,t){this.Cells[e][t]=0},e.prototype.RemoveTileByPos=function(e){this.RemoveTile(e.RowIndex,e.CellIndex)},e.prototype.GetTile=function(e,t){return new o.a(e,t,this.Cells[e][t])},e.prototype.UpdateTileByPos=function(e,t){this.Cells[e.RowIndex][e.CellIndex]=t},e.prototype.AvailableCells=function(){for(var e=[],t=0;t<this.Size;++t)for(var i=0;i<this.Size;++i)0==this.Cells[t][i]&&e.push(new o.b(t,i));return e},e.prototype.GetRowDataByDirection=function(e){var t=[];switch(e){case n.a.Left:for(var i=0;i<this.Size;++i){for(var o=[],r=0;r<this.Size;++r)o.push(this.GetTile(i,r));t.push(o)}break;case n.a.Right:for(i=0;i<this.Size;++i){for(o=[],r=0;r<this.Size;++r)o.push(this.GetTile(i,this.Size-r-1));t.push(o)}break;case n.a.Up:for(r=0;r<this.Size;++r){for(o=[],i=0;i<this.Size;++i)o.push(this.GetTile(i,r));t.push(o)}break;case n.a.Down:for(r=0;r<this.Size;++r){for(o=[],i=0;i<this.Size;++i)o.push(this.GetTile(this.Size-i-1,r));t.push(o)}}return t},e}()},7:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};function o(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}Object.assign},8:function(e,t,i){"use strict";function n(e,t){expect(e.length).toEqual(t.length,"Length of actual and expected events are not equal");for(var i=0;i<e.length;++i){var n=e[i],o=t[i];expect(n.NewIndex).toEqual(o.NewIndex,"comparison of NewIndex at index "+i),expect(n.OldIndex).toEqual(o.OldIndex,"comparison of OldIndex at index "+i),expect(n.MergedValue).toEqual(o.MergedValue,"comparison of MergedValue at index "+i),expect(n.Value).toEqual(o.Value,"comparison of OldValue at index "+i)}}function o(e,t){expect(e.length).toEqual(t.length,"Length of actual and expected events are not equal");for(var i=0;i<e.length;++i){var n=e[i],o=t[i];expect(n.CellIndex).toEqual(o.CellIndex,"comparison of CellIndex at index "+i),expect(n.RowIndex).toEqual(o.RowIndex,"comparison of RowIndex at index "+i),expect(n.Value).toEqual(o.Value,"comparison of Value at index "+i)}}i.d(t,"a",function(){return n}),i.d(t,"b",function(){return o})}});